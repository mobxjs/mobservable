<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>mobxUtils.createTransformer | MobX</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-edit-link/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-anchors/plugin.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
    

        
    
    
    <link rel="next" href="../refguide/expr.html" />
    
    
    <link rel="prev" href="../refguide/observe.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="6.10" data-basepath=".." data-revision="Tue Aug 14 2018 15:53:18 GMT+0200 (CEST)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> Introduction to MobX</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="intro/overview.html">
            
                
                    <a href="../intro/overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        The Gist of MobX
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="intro/concepts.html">
            
                
                    <a href="../intro/concepts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Concepts &amp; Principles
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="refguide/api.html">
            
                
                    <a href="../refguide/api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        API overview
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Making things observable</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="refguide/observable.html">
            
                
                    <a href="../refguide/observable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        observable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="refguide/observable-decorator.html">
            
                
                    <a href="../refguide/observable-decorator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        @observable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="refguide/object.html">
            
                
                    <a href="../refguide/object.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        objects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="refguide/array.html">
            
                
                    <a href="../refguide/array.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        arrays
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="refguide/map.html">
            
                
                    <a href="../refguide/map.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        maps
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="refguide/boxed.html">
            
                
                    <a href="../refguide/boxed.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        boxed values
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="refguide/modifiers.html">
            
                
                    <a href="../refguide/modifiers.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        decorators
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Reacting to observables</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="refguide/computed-decorator.html">
            
                
                    <a href="../refguide/computed-decorator.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        (@)computed
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="refguide/autorun.html">
            
                
                    <a href="../refguide/autorun.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        autorun
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="refguide/when.html">
            
                
                    <a href="../refguide/when.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        when
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="refguide/reaction.html">
            
                
                    <a href="../refguide/reaction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        reaction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="refguide/observer-component.html">
            
                
                    <a href="../refguide/observer-component.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        (@)observer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="best/react.html">
            
                
                    <a href="../best/react.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        Understanding what MobX reacts to
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" >
            
            <span><b>5.</b> Changing observables</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="refguide/action.html">
            
                
                    <a href="../refguide/action.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        action
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="best/actions.html">
            
                
                    <a href="../best/actions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        async actions &amp; flows
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="refguide/object-api.html">
            
                
                    <a href="../refguide/object-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Object api
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" >
            
            <span><b>6.</b> Utility functions</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="refguide/tojson.html">
            
                
                    <a href="../refguide/tojson.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        toJS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="refguide/extend-observable.html">
            
                
                    <a href="../refguide/extend-observable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        extendObservable
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="refguide/extending.html">
            
                
                    <a href="../refguide/extending.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        createAtom
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="refguide/observe.html">
            
                
                    <a href="../refguide/observe.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        intercept &amp; observe
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/mobx-utils#frompromise">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        mobxUtils.fromPromise
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/mobx-utils#fromresource">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        mobxUtils.fromResource
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.7" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/mobx-utils#tostream">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.7.</b>
                        
                        mobxUtils.toStream
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.8" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/mobx-utils#fromstream">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.8.</b>
                        
                        mobxUtils.fromStream
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.9" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/mobx-utils#now">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.9.</b>
                        
                        mobxUtils.now
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="6.10" data-path="refguide/create-transformer.html">
            
                
                    <a href="../refguide/create-transformer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.10.</b>
                        
                        mobxUtils.createTransformer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.11" data-path="refguide/expr.html">
            
                
                    <a href="../refguide/expr.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.11.</b>
                        
                        mobxUtils.expr
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" >
            
                
                    <a target="_blank" href="https://github.com/mobxjs/awesome-mobx#examples">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Blogs, videos, related projects
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" >
            
            <span><b>8.</b> Tips &amp; Tricks</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="faq/faq.html">
            
                
                    <a href="../faq/faq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Frequently Asked Questions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="best/pitfalls.html">
            
                
                    <a href="../best/pitfalls.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Common Pitfalls &amp; Best Practices
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="best/decorators.html">
            
                
                    <a href="../best/decorators.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        How to (not) use decorator syntax
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="best/trace.html">
            
                
                    <a href="../best/trace.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Using trace for debugging
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="best/store.html">
            
                
                    <a href="../best/store.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Defining data stores
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="best/react-performance.html">
            
                
                    <a href="../best/react-performance.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        Optimizing React components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="best/devtools.html">
            
                
                    <a href="../best/devtools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        DevTools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="refguide/spy.html">
            
                
                    <a href="../refguide/spy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        spy
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="donating.html">
            
                
                    <a href="../donating.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Donate
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >MobX</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <html><head></head><body><a id="edit-link" href="https://github.com/mobxjs/mobx/tree/gh-pages/docs/refguide/create-transformer.md" class="btn fa fa-edit pull-left">&#xA0;&#xA0;Edit This Page</a><h1 id="createtransformer"><a name="createtransformer" class="plugin-anchor" href="#createtransformer"><span class="fa fa-link"></span></a>createTransformer</h1>
<p>Provided by the <code>mobx-utils</code> package.</p>
<p><code>createTransformer&lt;A, B&gt;(transformation: (value: A) =&gt; B, onCleanup?: (result: B, value?: A) =&gt; void): (value: A) =&gt; B</code></p>
<p><code>createTransformer</code> turns a function (that should transform value <code>A</code> into another value <code>B</code>) into a reactive and memoizing function.
In other words, if the <code>transformation</code> function computes B given a specific A, the same B will be returned for all other future invocations of the transformation with the same A.
However, if A changes, the transformation will be re-applied so that B is updated accordingly.
And last but not least, if nobody is using the transformation of a specific A anymore, its entry will be removed from the memoization table.</p>
<p>With <code>createTransformer</code> it is very easy to transform a complete data graph into another data graph.
Transformation functions can be composed so that you can build a tree using lots of small transformations.
The resulting data graph will never be stale, it will be kept in sync with the source by applying small patches to the result graph.
This makes it very easy to achieve powerful patterns similar to sideways data loading, map-reduce, tracking state history using immutable data structures etc.</p>
<p>The optional <code>onCleanup</code> function can be used to get a notification when a transformation of an object is no longer needed.
This can be used to dispose resources attached to the result object if needed.</p>
<p>Always use transformations inside a reaction like <code>@observer</code> or <code>autorun</code>.
Transformations will, like any other computed value, fall back to lazy evaluation if not observed by something, which sort of defeats their purpose.</p>
<p>This all might still be a bit vague, so here are two examples that explain this whole idea of transforming one data structure into another by using small, reactive functions:</p>
<h2 id="tracking-mutable-state-using-immutable-shared-data-structures"><a name="tracking-mutable-state-using-immutable-shared-data-structures" class="plugin-anchor" href="#tracking-mutable-state-using-immutable-shared-data-structures"><span class="fa fa-link"></span></a>Tracking mutable state using immutable, shared data structures.</h2>
<p>This example is taken from the <a href="https://github.com/mobxjs/mobx-reactive2015-demo" target="_blank">Reactive2015 conference demo</a>:</p>
<pre><code class="lang-javascript"><span class="hljs-comment">/*
    The store that holds our domain: boxes and arrows
*/</span>
<span class="hljs-keyword">const</span> store = observable({
    boxes: [],
    arrows: [],
    selection: <span class="hljs-literal">null</span>
});

<span class="hljs-comment">/**
    Serialize store to json upon each change and push it onto the states list
*/</span>
<span class="hljs-keyword">const</span> states = [];

autorun(() =&gt; {
    states.push(serializeState(store));
});

<span class="hljs-keyword">const</span> serializeState = createTransformer(store =&gt; ({
    boxes: store.boxes.map(serializeBox),
    arrows: store.arrows.map(serializeArrow),
    selection: store.selection ? store.selection.id : <span class="hljs-literal">null</span>
}));

<span class="hljs-keyword">const</span> serializeBox = createTransformer(box =&gt; ({...box}));

<span class="hljs-keyword">const</span> serializeArrow = createTransformer(arrow =&gt; ({
    id: arrow.id,
    to: arrow.to.id,
    from: arrow.from.id
}));
</code></pre>
<p>In this example the state is serialized by composing three different transformation functions.
The autorunner triggers the serialization of the <code>store</code> object, which in turn serializes all boxes and arrows.
Let&apos;s take closer look at the life of an imaginary example box#3.</p>
<ol>
<li>The first time box#3 is passed by <code>map</code> to <code>serializeBox</code>,
the serializeBox transformation is executed and an entry containing box#3 and its serialized representation is added to the internal memoization table of <code>serializeBox</code>.</li>
<li>Imagine that another box is added to the <code>store.boxes</code> list.
This would cause the <code>serializeState</code> function to re-compute, resulting in a complete remapping of all the boxes.
However, all the invocations of <code>serializeBox</code> will now return their old values from the memoization tables since their transformation functions didn&apos;t (need to) run again.</li>
<li>Secondly, if somebody changes a property of box#3 this will cause the application of the <code>serializeBox</code> to box#3 to re-compute, just like any other reactive function in MobX.
Since the transformation will now produce a new Json object based on box#3, all observers of that specific transformation will be forced to run again as well.
That&apos;s the <code>serializeState</code> transformation in this case.
<code>serializeState</code> will now produce a new value in turn and map all the boxes again. But except for box#3, all other boxes will be returned from the memoization table.</li>
<li>Finally, if box#3 is removed from <code>store.boxes</code>, <code>serializeState</code> will compute again.
But since it will no longer be using the application of <code>serializeBox</code> to box#3,
that reactive function will go back to non-reactive mode.
This signals the memoization table that the entry can be removed so that it is ready for GC.</li>
</ol>
<p>So effectively we have achieved state tracking using immutable, shared datas structures here.
All boxes and arrows are mapped and reduced into single state tree.
Each change will result in a new entry in the <code>states</code> array, but the different entries will share almost all of their box and arrow representations.</p>
<h2 id="transforming-a-datagraph-into-another-reactive-data-graph"><a name="transforming-a-datagraph-into-another-reactive-data-graph" class="plugin-anchor" href="#transforming-a-datagraph-into-another-reactive-data-graph"><span class="fa fa-link"></span></a>Transforming a datagraph into another reactive data graph</h2>
<p>Instead of returning plain values from a transformation function, it is also possible to return observable objects.
This can be used to transform an observable data graph into a another observable data graph, which can be used to transform... you get the idea.</p>
<p>Here is a small example that encodes a reactive file explorer that will update its representation upon each change.
Data graphs that are built this way will in general react a lot faster and will consist of much more straight-forward code,
compared to derived data graph that are updated using your own code. See the <a href="https://github.com/mobxjs/mobx/blob/3ea1f4af20a51a1cb30be3e4a55ec8f964a8c495/test/perf/transform-perf.js#L4" target="_blank">performance tests</a> for some examples.</p>
<p>Unlike the previous example, the <code>transformFolder</code> will only run once as long as a folder remains visible;
the <code>DisplayFolder</code> objects track the associated <code>Folder</code> objects themselves.</p>
<p>In the following example all mutations to the <code>state</code> graph will be processed automatically.
Some examples:</p>
<ol>
<li>Changing the name of a folder will update its own <code>path</code> property and the <code>path</code> property of all its descendants.</li>
<li>Collapsing a folder will remove all descendant <code>DisplayFolders</code> from the tree.</li>
<li>Expanding a folder will restore them again.</li>
<li>Setting a search filter will remove all nodes that do not match the filter, unless they have a descendant that matches the filter.</li>
<li>Etc.</li>
</ol>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> m = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mobx&apos;</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Folder</span>(<span class="hljs-params">parent, name</span>) </span>{
    <span class="hljs-keyword">this</span>.parent = parent;
    m.extendObservable(<span class="hljs-keyword">this</span>, {
        name: name,
        children: m.observable.shallow([]),
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DisplayFolder</span>(<span class="hljs-params">folder, state</span>) </span>{
    <span class="hljs-keyword">this</span>.state = state;
    <span class="hljs-keyword">this</span>.folder = folder;
    m.extendObservable(<span class="hljs-keyword">this</span>, {
        collapsed: <span class="hljs-literal">false</span>,
        get name() {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.folder.name;
        },
        get isVisible() {
            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">this</span>.state.filter || <span class="hljs-keyword">this</span>.name.indexOf(<span class="hljs-keyword">this</span>.state.filter) !== -<span class="hljs-number">1</span> || <span class="hljs-keyword">this</span>.children.some(child =&gt; child.isVisible);
        },
        get children() {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collapsed)
                <span class="hljs-keyword">return</span> [];
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.folder.children.map(transformFolder).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">child</span>) </span>{
                <span class="hljs-keyword">return</span> child.isVisible;
            })
        },
        get path() {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.folder.parent === <span class="hljs-literal">null</span> ? <span class="hljs-keyword">this</span>.name : transformFolder(<span class="hljs-keyword">this</span>.folder.parent).path + <span class="hljs-string">&quot;/&quot;</span> + <span class="hljs-keyword">this</span>.name;
        })
    });
}

<span class="hljs-keyword">var</span> state = m.observable({
    root: <span class="hljs-keyword">new</span> Folder(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;root&quot;</span>),
    filter: <span class="hljs-literal">null</span>,
    displayRoot: <span class="hljs-literal">null</span>
});

<span class="hljs-keyword">var</span> transformFolder = m.createTransformer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">folder</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DisplayFolder(folder, state);
});


<span class="hljs-comment">// returns list of strings per folder</span>
<span class="hljs-keyword">var</span> stringTransformer = m.createTransformer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">displayFolder</span>) </span>{
    <span class="hljs-keyword">var</span> path = displayFolder.path;
    <span class="hljs-keyword">return</span> path + <span class="hljs-string">&quot;\n&quot;</span> +
        displayFolder.children.filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">child</span>) </span>{
            <span class="hljs-keyword">return</span> child.isVisible;
        }).map(stringTransformer).join(<span class="hljs-string">&apos;&apos;</span>);
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createFolders</span>(<span class="hljs-params">parent, recursion</span>) </span>{
    <span class="hljs-keyword">if</span> (recursion === <span class="hljs-number">0</span>)
        <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
        <span class="hljs-keyword">var</span> folder = <span class="hljs-keyword">new</span> Folder(parent, i + <span class="hljs-string">&apos;&apos;</span>);
        parent.children.push(folder);
        createFolders(folder, recursion - <span class="hljs-number">1</span>);
    }
}

createFolders(state.root, <span class="hljs-number">2</span>); <span class="hljs-comment">// 3^2</span>

m.autorun(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    state.displayRoot = transformFolder(state.root);
    state.text = stringTransformer(state.displayRoot)
    <span class="hljs-built_in">console</span>.log(state.text)
});

state.root.name = <span class="hljs-string">&apos;wow&apos;</span>; <span class="hljs-comment">// change folder name</span>
state.displayRoot.children[<span class="hljs-number">1</span>].collapsed = <span class="hljs-literal">true</span>; <span class="hljs-comment">// collapse folder</span>
state.filter = <span class="hljs-string">&quot;2&quot;</span>; <span class="hljs-comment">// search</span>
state.filter = <span class="hljs-literal">null</span>; <span class="hljs-comment">// unsearch</span>
</code></pre>
</body></html>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../refguide/observe.html" class="navigation navigation-prev " aria-label="Previous page: intercept &amp; observe"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../refguide/expr.html" class="navigation navigation-next " aria-label="Next page: mobxUtils.expr"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"github":{"url":"https://github.com/mobxjs/mobx"},"edit-link":{"base":"https://github.com/mobxjs/mobx/tree/gh-pages/docs","label":"Edit This Page"},"ga":{"token":"UA-65632006-1","configuration":"auto"},"disqus":{"shortName":"mobservable"}};
    gitbook.start(config);
});
</script>

        <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-65632006-1', 'auto');ga('send', 'pageview');</script>
    </body>
    
</html>
